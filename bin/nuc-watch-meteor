#!/usr/bin/env node

var cli = require("commander"),
    path = require("path"),
    watcher = require("../lib/watcher"),
    app_inspector = require("../lib/app_crash_inspector.js");

cli
  .version("0.0.1")
  .option("-d, --dir <dir>", "Directory to watch changes in")
  .option("-u, --url <url>", "Url where meteor app is running")
  .option("-w, --wait <n>","Wait time in milliseconds", parseInt)
  .parse(process.argv);

if (! cli.dir || ! cli.url) {
  cli.help();
}

var dir = path.resolve(cli.dir),
    wait = cli.wait || 2000,
    url = cli.url.indexOf("http") === 0 ? cli.url : "http://"+cli.url;

console.log('url is ', url);

watcher.start_watching(dir, wait, function() {
  app_inspector.if_crashed('http://localhost:3000/', function() {
    console.log('APP IS CRASHED');
  });
});
